import*as THREE from"https://unpkg.com/three@0.139.2/build/three.module.js";import{simulationVertexShader,simulationFragmentShader,renderVertexShader,renderFragmentShader}from"./shaders.js";document.addEventListener("DOMContentLoaded",async()=>{const e=document.getElementById("glcanvas");if(!e)return void console.error("Canvas element not found!");const t=window.innerWidth<768?"low-power":"high-performance",n=new THREE.WebGLRenderer({canvas:e,antialias:!1,alpha:!0,preserveDrawingBuffer:!1,powerPreference:t}),r=new THREE.Scene,o=new THREE.Scene,a=new THREE.OrthographicCamera(-1,1,1,-1,0,1),i=window.innerWidth<768,l=i?1.25:Math.min(window.devicePixelRatio,2);let s=Math.floor(window.innerWidth*l),d=Math.floor(window.innerHeight*l);const m=i?3:2,u=Math.floor(s/m),c=Math.floor(d/m);n.setPixelRatio(l),n.setSize(u,c,!1);const h={format:THREE.RGBAFormat,type:THREE.HalfFloatType,minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,stencilBuffer:!1,depthBuffer:!1};let f=new THREE.WebGLRenderTarget(u,c,h),E=new THREE.WebGLRenderTarget(u,c,h);const w=new THREE.ShaderMaterial({uniforms:{textureA:{value:null},mouse:{value:new THREE.Vector2(-10,-10)},resolution:{value:new THREE.Vector2(u,c)},time:{value:0},frame:{value:0}},vertexShader:simulationVertexShader,fragmentShader:simulationFragmentShader}),p=new THREE.ShaderMaterial({uniforms:{textureA:{value:null},time:{value:0}},vertexShader:renderVertexShader,fragmentShader:renderFragmentShader,transparent:!0,depthWrite:!1}),x=new THREE.PlaneGeometry(2,2),g=new THREE.Mesh(x,w),v=new THREE.Mesh(x,p);o.add(g),r.add(v);let R=0,S=0;function T(e,t){const r=n.domElement.getBoundingClientRect();let o=(e-r.left)/r.width,a=1-(t-r.top)/r.height;o*=u,a*=c,w.uniforms.mouse.value.set(o,a)}n.domElement.addEventListener("mousemove",e=>{T(e.clientX,e.clientY)}),n.domElement.addEventListener("mouseleave",()=>{w.uniforms.mouse.value.set(-10,-10)}),n.domElement.addEventListener("touchstart",e=>{e.preventDefault(),e.touches.length>0&&T(e.touches[0].clientX,e.touches[0].clientY)}),n.domElement.addEventListener("touchmove",function(e){e.preventDefault();const t=performance.now();t-S<16||(S=t,e.touches.length>0&&T(e.touches[0].clientX,e.touches[0].clientY))}),n.domElement.addEventListener("touchend",()=>{w.uniforms.mouse.value.set(-10,-10)}),window.addEventListener("resize",()=>{s=Math.floor(window.innerWidth*l),d=Math.floor(window.innerHeight*l);const e=Math.floor(s/m),t=Math.floor(d/m);n.setSize(e,t,!1),f.setSize(e,t),E.setSize(e,t),w.uniforms.resolution.value.set(e,t),R=0});const M=()=>{w.uniforms.frame.value=R++,w.uniforms.time.value=performance.now()/1e3,w.uniforms.textureA.value=f.texture,n.setRenderTarget(E),n.render(o,a),p.uniforms.textureA.value=E.texture,p.uniforms.time.value=performance.now()/1e3,n.setRenderTarget(null),n.render(r,a),[f,E]=[E,f],requestAnimationFrame(M)};M()});const textContainer=document.getElementById("scroll-down");function applyTextEffects(){const e=textContainer.textContent;textContainer.innerHTML="",e.split("").forEach(e=>{let t=document.createElement("span");t.textContent=e,t.style.display="inline-block",t.style.webkitTextFillColor="rgba(0, 0, 0, 0.03)",t.style.webkitTextStroke="1px rgba(122, 122, 122, 0.01)",t.style.transition="all 0.1s ease-out",t.style.textShadow="none",textContainer.appendChild(t)});const t=document.querySelectorAll("#scroll-down span");let n=0;document.addEventListener("mousemove",function(e){if(performance.now()-n<50)return;n=performance.now();const r=e.clientX,o=e.clientY,a=window.innerWidth,i=window.innerHeight,l=a/2,s=i/2;t.forEach((e,n)=>{const a=e.getBoundingClientRect(),i=a.left+a.width/2,d=a.top+a.height/2,m=Math.abs(i-r),u=Math.abs(d-o),c=Math.floor((l-m)/l*8)+1,h=Math.min(9,Math.max(1,c));e.style.webkitTextStrokeWidth=`${h}px`;const f=Math.floor((s-u)/s*400)+100;let E=n/t.length*300;e.style.fontVariationSettings=`'wght' ${Math.min(400,Math.max(100,f+E))}`;const w=1+h/30;e.style.transform=`scale(${w})`;const p=1*h;e.style.marginRight=`${p}px`;const x=Math.max(0,(l-m)/l);e.style.textShadow=x>.1?`rgba(123, 123, 123, ${x}) -1px -1px ${6*x}px,\n                   rgba(110, 110, 110, ${x}) -1px -1px ${12*x}px,\n                   rgba(122, 122, 122, ${x}) -1px -1px ${30*x}px`:"none"})})}function handleScrollDown(){const e=document.querySelector("#bo");e&&e.scrollIntoView({behavior:"smooth"})}window.innerWidth>=1e3&&applyTextEffects(),document.getElementById("scroll-down").addEventListener("click",handleScrollDown);